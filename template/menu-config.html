
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 页面编号: C-03 /admin/menu-config -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>菜单配置 - 酒店管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <style>
        :root {
            --primary: #0F62FE;
            --secondary: #FF6B00;
            --bg: #F5F7FA;
        }
        .dragging {
            opacity: 0.5;
        }
        .drag-over {
            background-color: #EBF5FF;
        }
    </style>
</head>
<body class="bg-gray-50 font-[system-ui]" x-data="menuConfigApp()">
<div class="min-h-screen flex">
    <!-- 侧边栏（复用） -->
    <aside class="w-64 bg-white shadow-lg">
        <div class="p-6">
            <h1 class="text-2xl font-bold text-gray-800 flex items-center">
                <i class="uil uil-building mr-2 text-blue-600"></i>
                酒店管理系统
            </h1>
        </div>
        <nav class="mt-6">
            <a href="#" @click="navigateTo('dashboard')" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                <i class="uil uil-dashboard mr-3"></i>
                仪表板
            </a>
            <a href="#" class="flex items-center px-6 py-3 bg-blue-50 text-blue-600 border-r-4 border-blue-600">
                <i class="uil uil-list-ul mr-3"></i>
                菜单配置
            </a>
            <a href="#" @click="navigateTo('user-management')" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                <i class="uil uil-users-alt mr-3"></i>
                用户管理
            </a>
            <a href="#" @click="navigateTo('system-settings')" class="flex items-center px-6 py-3 text-gray-600 hover:bg-gray-50">
                <i class="uil uil-setting mr-3"></i>
                系统设置
            </a>
        </nav>
    </aside>

    <!-- 主内容区 -->
    <main class="flex-1 p-8">
        <!-- 顶部标题 -->
        <div class="mb-8 flex items-center justify-between">
            <div>
                <h2 class="text-3xl font-bold text-gray-800">菜单配置</h2>
                <p class="text-gray-600 mt-2">配置客人聊天界面的快捷菜单</p>
            </div>
            <div class="flex space-x-3">
                <button
                        @click="previewMenu"
                        data-testid="preview-button"
                        class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center"
                >
                    <i class="uil uil-eye mr-2"></i>
                    预览
                </button>
                <button
                        @click="saveMenu"
                        data-testid="save-button"
                        :disabled="!hasChanges"
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center"
                >
                    <i class="uil uil-save mr-2"></i>
                    保存配置
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 菜单树结构 -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">菜单结构</h3>
                        <p class="text-sm text-gray-600 mt-1">拖拽调整菜单顺序，点击编辑内容</p>
                    </div>
                    <div class="p-6">
                        <!-- 菜单项列表 -->
                        <div class="space-y-2">
                            <template x-for="(item, index) in menuItems" :key="item.id">
                                <div
                                        :data-id="item.id"
                                        draggable="true"
                                        @dragstart="handleDragStart($event, index)"
                                        @dragover.prevent="handleDragOver($event)"
                                        @drop="handleDrop($event, index)"
                                        @dragend="handleDragEnd"
                                        class="bg-gray-50 rounded-lg p-4 cursor-move hover:bg-gray-100 transition-colors"
                                        :class="{ 'ml-8': item.level > 1 }"
                                >
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center flex-1">
                                            <i class="uil uil-draggabledots text-gray-400 mr-3"></i>
                                            <i :class="item.icon" class="text-gray-600 mr-3"></i>
                                            <div class="flex-1">
                                                <span class="font-medium text-gray-800" x-text="item.label.zh"></span>
                                                <span class="text-sm text-gray-500 ml-2" x-text="'(' + item.label.en + ')'"></span>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <button
                                                    @click="editItem(item)"
                                                    class="p-1 text-blue-600 hover:bg-blue-50 rounded"
                                            >
                                                <i class="uil uil-edit"></i>
                                            </button>
                                            <button
                                                    @click="deleteItem(item.id)"
                                                    class="p-1 text-red-600 hover:bg-red-50 rounded"
                                            >
                                                <i class="uil uil-trash-alt"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- 子菜单 -->
                                    <div x-show="item.children && item.children.length > 0" class="mt-3 ml-6 space-y-2">
                                        <template x-for="child in item.children" :key="child.id">
                                            <div class="bg-white rounded p-3 flex items-center justify-between">
                                                <span class="text-sm text-gray-700" x-text="child.label.zh"></span>
                                                <div class="flex items-center space-x-1">
                                                    <button class="p-1 text-blue-600 hover:bg-blue-50 rounded text-sm">
                                                        <i class="uil uil-edit"></i>
                                                    </button>
                                                    <button class="p-1 text-red-600 hover:bg-red-50 rounded text-sm">
                                                        <i class="uil uil-trash-alt"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- 添加新菜单项 -->
                        <button
                                @click="addNewItem"
                                data-testid="add-menu-item"
                                class="mt-4 w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors flex items-center justify-center"
                        >
                            <i class="uil uil-plus mr-2"></i>
                            添加菜单项
                        </button>
                    </div>
                </div>
            </div>

            <!-- 编辑面板 -->
            <div>
                <div class="bg-white rounded-lg shadow" x-show="editingItem">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">编辑菜单项</h3>
                    </div>
                    <div class="p-6 space-y-4">
                        <!-- 图标选择 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">图标</label>
                            <div class="grid grid-cols-4 gap-2">
                                <template x-for="icon in availableIcons" :key="icon">
                                    <button
                                            @click="editingItem.icon = icon"
                                            :class="editingItem.icon === icon ? 'bg-blue-100 border-blue-600' : 'bg-white border-gray-300'"
                                            class="p-3 border-2 rounded-lg hover:border-blue-400 transition-colors"
                                    >
                                        <i :class="icon" class="text-xl"></i>
                                    </button>
                                </template>
                            </div>
                        </div>

                        <!-- 多语言标签 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">标签文本</label>
                            <div class="space-y-2">
                                <input
                                        type="text"
                                        x-model="editingItem.label.zh"
                                        placeholder="中文"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                <input
                                        type="text"
                                        x-model="editingItem.label.en"
                                        placeholder="English"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                                <input
                                        type="text"
                                        x-model="editingItem.label.ja"
                                        placeholder="日本語"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                >
                            </div>
                        </div>

                        <!-- 模板消息 -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">快捷消息模板</label>
                            <textarea
                                    x-model="editingItem.template"
                                    rows="3"
                                    placeholder="点击菜单时发送的消息内容"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            ></textarea>
                        </div>

                        <!-- 操作按钮 -->
                        <div class="flex space-x-3">
                            <button
                                    @click="saveItemEdit"
                                    class="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                            >
                                保存
                            </button>
                            <button
                                    @click="cancelEdit"
                                    class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                            >
                                取消
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 语言切换预览 -->
                <div class="bg-white rounded-lg shadow mt-6">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800">语言预览</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-2">
                            <button
                                    @click="previewLang = 'zh'"
                                    :class="previewLang === 'zh' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="w-full py-2 rounded-lg transition-colors"
                            >
                                简体中文
                            </button>
                            <button
                                    @click="previewLang = 'en'"
                                    :class="previewLang === 'en' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="w-full py-2 rounded-lg transition-colors"
                            >
                                English
                            </button>
                            <button
                                    @click="previewLang = 'ja'"
                                    :class="previewLang === 'ja' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'"
                                    class="w-full py-2 rounded-lg transition-colors"
                            >
                                日本語
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // Mock数据
    const MOCK_MENU = [
        {
            id: 1,
            label: { zh: '客房服务', en: 'Room Service', ja: 'ルームサービス' },
            icon: 'uil uil-room',
            template: '我需要客房服务',
            level: 1,
            children: []
        },
        {
            id: 2,
            label: { zh: '餐饮服务', en: 'Dining', ja: 'ダイニング' },
            icon: 'uil uil-restaurant',
            template: '我想点餐',
            level: 1,
            children: []
        },
        {
            id: 3,
            label: { zh: '清洁服务', en: 'Housekeeping', ja: 'ハウスキーピング' },
            icon: 'uil uil-brush-alt',
            template: '请打扫房间',
            level: 1,
            children: []
        },
        {
            id: 4,
            label: { zh: '其他帮助', en: 'Other Help', ja: 'その他' },
            icon: 'uil uil-question-circle',
            template: '我需要其他帮助',
            level: 1,
            children: []
        }
    ];

    function menuConfigApp() {
        return {
            menuItems: [...MOCK_MENU],
            editingItem: null,
            hasChanges: false,
            draggedIndex: null,
            previewLang: 'zh',
            availableIcons: [
                'uil uil-room',
                'uil uil-restaurant',
                'uil uil-brush-alt',
                'uil uil-question-circle',
                'uil uil-bell',
                'uil uil-car',
                'uil uil-wifi',
                'uil uil-phone'
            ],

            handleDragStart(e, index) {
                this.draggedIndex = index;
                e.target.classList.add('dragging');
            },

            handleDragOver(e) {
                e.target.classList.add('drag-over');
            },

            handleDrop(e, dropIndex) {
                e.target.classList.remove('drag-over');

                if (this.draggedIndex !== null && this.draggedIndex !== dropIndex) {
                    const draggedItem = this.menuItems[this.draggedIndex];
                    this.menuItems.splice(this.draggedIndex, 1);
                    this.menuItems.splice(dropIndex, 0, draggedItem);
                    this.hasChanges = true;
                }
            },

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
                this.draggedIndex = null;
            },

            editItem(item) {
                this.editingItem = JSON.parse(JSON.stringify(item));
            },

            saveItemEdit() {
                const index = this.menuItems.findIndex(item => item.id === this.editingItem.id);
                if (index !== -1) {
                    this.menuItems[index] = { ...this.editingItem };
                    this.hasChanges = true;
                }
                this.editingItem = null;
            },

            cancelEdit() {
                this.editingItem = null;
            },

            deleteItem(id) {
                if (confirm('确定要删除这个菜单项吗？')) {
                    this.menuItems = this.menuItems.filter(item => item.id !== id);
                    this.hasChanges = true;
                }
            },

            addNewItem() {
                const newItem = {
                    id: Date.now(),
                    label: { zh: '新菜单项', en: 'New Item', ja: '新しい項目' },
                    icon: 'uil uil-question-circle',
                    template: '',
                    level: 1,
                    children: []
                };
                this.menuItems.push(newItem);
                this.editingItem = newItem;
                this.hasChanges = true;
            },

            saveMenu() {
                console.log('保存菜单配置');
                // 模拟 API 调用: PUT /config/menu
                console.log('PUT /config/menu', this.menuItems);
                this.hasChanges = false;
                alert('菜单配置已保存！');
            },

            previewMenu() {
                console.log('预览菜单');
                alert('预览功能正在开发中...');
            },

            navigateTo(page) {
                if (this.hasChanges) {
                    if (!confirm('您有未保存的更改，确定要离开吗？')) {
                        return;
                    }
                }
                console.log(`跳转到 /admin/${page}`);
                const pageMap = {
                    'menu-config': 'C-03-menu-config.html',
                    'user-management': 'C-07-user-management.html',
                    'system-settings': 'C-08-system-settings.html',
                    'dashboard': 'C-01-dashboard.html'
                };
                window.location.href = pageMap[page] || 'C-01-dashboard.html';
            }
        };
    }
</script>
</body>
</html>