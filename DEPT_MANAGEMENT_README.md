# 部门管理功能说明

## 功能概述

部门管理功能是酒店管理系统管理员后台的重要组成部分，提供了完整的部门管理解决方案，包括部门的增删改查、成员管理等功能。

## 功能特性

### 1. 部门列表管理
- **查看部门列表**：以卡片形式展示所有部门信息
- **部门信息**：显示部门名称、负责人、成员数量
- **快速操作**：查看详情、编辑、删除部门

### 2. 部门详情管理
- **部门信息**：查看部门详细信息
- **成员列表**：管理部门成员
- **成员操作**：添加新成员、移除现有成员

### 3. 部门创建与编辑
- **创建部门**：设置部门名称和指定负责人
- **编辑部门**：修改部门名称和负责人
- **数据验证**：确保输入数据的有效性

### 4. 成员管理
- **添加成员**：通过通用用户选择弹窗从真实用户数据中选择并添加到部门
- **移除成员**：从部门中移除指定成员
- **批量操作**：支持同时添加多个成员
- **智能过滤**：自动排除已经是部门成员的用户
- **搜索功能**：支持按用户名、姓名、工号、部门进行搜索

## 技术实现

### API 接口
基于 `DeptManagementAPI.json` 中定义的 OpenAPI 规范，实现了以下接口：

- `POST /dept/select-list` - 获取部门选择列表
- `POST /dept/list` - 获取部门列表
- `POST /dept/detail` - 获取部门详情
- `POST /dept/create` - 创建部门
- `POST /dept/update` - 更新部门
- `POST /dept/delete` - 删除部门
- `POST /dept/add-user` - 添加部门成员
- `POST /dept/remove-user` - 移除部门成员

### 文件结构
```
src/
├── api/
│   ├── deptApi.ts          # 部门管理 API 调用函数
│   ├── userApi.ts          # 用户管理 API 调用函数
│   └── types.ts            # 类型定义（包含部门相关类型）
├── pages/
│   └── DeptManagement.tsx  # 部门管理页面组件
├── components/
│   ├── UserSelectorModal.tsx    # 通用用户选择弹窗组件
│   ├── UserSelectorModal.example.tsx # 使用示例
│   └── ConfirmModal.tsx    # 确认弹窗组件（复用）
└── utils/
    └── deptDataTransform.ts # 数据转换工具函数
```

### 组件特性
- **响应式设计**：适配不同屏幕尺寸
- **状态管理**：使用 React hooks 管理组件状态
- **错误处理**：统一的错误提示和加载状态
- **用户体验**：流畅的交互和视觉反馈
- **通用组件**：UserSelectorModal 可在多个场景中复用
- **真实数据**：通过 searchUser API 获取真实用户数据
- **智能搜索**：支持多字段搜索和前端过滤

## 使用说明

### 1. 访问部门管理
在管理员后台侧边栏中点击"部门管理"菜单项，即可进入部门管理页面。

### 2. 查看部门列表
- 页面默认显示部门列表视图
- 每个部门卡片显示：部门名称、负责人、成员数量
- 提供查看详情、编辑、删除等操作按钮

### 3. 创建新部门
1. 点击页面右上角的"添加部门"按钮
2. 填写部门名称
3. 输入负责人用户ID
4. 点击"保存"完成创建

### 4. 编辑部门信息
1. 在部门卡片中点击编辑按钮
2. 修改部门名称或负责人
3. 点击"保存"完成更新

### 5. 查看部门详情
1. 点击部门卡片中的"查看详情"按钮或"查看详情 →"链接
2. 切换到部门详情视图
3. 查看部门成员列表

### 6. 管理部门成员
- **添加成员**：在部门详情页面点击"添加成员"按钮，打开用户选择弹窗
  - 支持搜索用户（按用户名、姓名、工号、部门）
  - 自动排除已经是部门成员的用户
  - 支持多选用户
  - 显示用户状态（启用/禁用）
- **移除成员**：在成员列表中点击移除按钮

### 7. 删除部门
1. 在部门卡片中点击删除按钮
2. 确认删除操作
3. 注意：删除部门会同时删除所有成员关联

## 注意事项

1. **权限要求**：需要管理员权限才能访问部门管理功能
2. **数据一致性**：删除部门会同时删除所有成员关联，请谨慎操作
3. **用户ID**：创建部门时需要输入有效的用户ID作为负责人
4. **网络状态**：确保网络连接正常，API 调用失败时会显示错误提示

## 通用用户选择组件

### UserSelectorModal 组件
`UserSelectorModal` 是一个通用的用户选择弹窗组件，可以在多个场景中复用：

#### 主要特性
- **真实数据**：通过 `searchUser` API 获取真实用户数据
- **搜索功能**：支持按用户名、姓名、工号、部门进行搜索
- **多选支持**：支持选择多个用户
- **智能过滤**：可以排除指定的用户ID
- **分页加载**：支持分页加载更多用户
- **状态显示**：显示用户启用/禁用状态

#### 使用示例
```tsx
import UserSelectorModal from '../components/UserSelectorModal';

const MyComponent = () => {
  const [showModal, setShowModal] = useState(false);
  
  const handleUserSelection = (users: UserItem[]) => {
    console.log('选中的用户:', users);
    // 处理选中的用户
  };

  return (
    <UserSelectorModal
      isOpen={showModal}
      onClose={() => setShowModal(false)}
      onConfirm={handleUserSelection}
      title="选择用户"
      confirmText="确认选择"
      excludeUserIds={[1, 2, 3]} // 排除指定用户
      maxSelection={5} // 最多选择5个用户
    />
  );
};
```

#### 适用场景
- 部门管理：添加部门成员
- 角色管理：分配用户到角色
- 任务管理：分配任务执行人
- 权限管理：分配权限给用户
- 任何需要选择用户的场景

## 开发说明

### 添加新功能
如需扩展部门管理功能，请参考现有代码结构：

1. 在 `types.ts` 中定义新的类型
2. 在 `deptApi.ts` 中添加新的 API 调用函数
3. 在 `DeptManagement.tsx` 中实现新的 UI 组件
4. 在 `deptDataTransform.ts` 中添加数据转换函数

### 使用通用组件
如需在其他页面使用用户选择功能：

1. 导入 `UserSelectorModal` 组件
2. 定义状态管理弹窗显示
3. 实现用户选择处理函数
4. 配置组件属性（标题、确认文本、排除用户等）

### 样式定制
部门管理页面使用 Tailwind CSS 进行样式设计，可以通过修改类名来调整外观。

### 错误处理
所有 API 调用都包含完整的错误处理机制，确保用户能够及时了解操作结果。
